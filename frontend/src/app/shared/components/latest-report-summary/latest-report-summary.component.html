<ng-container *ngIf="analyses?.length; else emptyState">
  <app-glass-card [extraClass]="'glass-strong flex flex-col gap-4'">
    <div class="flex flex-wrap justify-between gap-3 items-start">
      <div class="space-y-1">
        <h3 class="text-xl font-semibold text-[var(--text)]">{{ 'PATIENT.DASHBOARD.LATEST' | translate }}</h3>
        <p class="text-sm text-[var(--text-dim)]">{{ 'PATIENT.DASHBOARD.LATEST_SUBTITLE' | translate }}</p>
        <div class="flex flex-wrap gap-3 text-sm text-[var(--text-dim)]">
          <span>
            {{ 'PATIENT.DASHBOARD.DATE' | translate }}
            <span *ngIf="latestDate(latestAnalysis); else noDate">
              {{ latestDate(latestAnalysis) | date: 'd MMMM yyyy' }}
            </span>
            <ng-template #noDate>{{ 'PATIENT.DASHBOARD.NO_DATE' | translate }}</ng-template>
          </span>
          <span *ngIf="sourceLabel">
            {{ 'PATIENT.DASHBOARD.SOURCE' | translate }} {{ sourceLabel }}
          </span>
          <span>
            {{ 'PATIENT.DASHBOARD.METRICS' | translate }} {{ metricsCount }}
          </span>
        </div>
      </div>
      <button *ngIf="showChartsButton" type="button" appGlassButton routerLink="/patient/charts">
        <i class="bi bi-graph-up"></i>
        <span class="hidden sm:inline">{{ 'PATIENT.DASHBOARD.GO_CHARTS' | translate }}</span>
        <span class="sm:hidden">{{ 'PATIENT.DASHBOARD.CHARTS' | translate }}</span>
      </button>
    </div>

    <div class="grid gap-4 sm:grid-cols-2 xl:grid-cols-3" *ngIf="summaryMetrics.length > 0">
      <app-glass-card
        *ngFor="let metric of summaryMetrics"
        [extraClass]="'glass-strong h-full'">
        <div class="flex items-start justify-between gap-3">
          <div class="space-y-1">
            <p class="uppercase text-[var(--text-dim)] text-xs tracking-[0.2em]">{{ metric.name }}</p>
            <div class="flex items-baseline gap-2">
              <span class="text-3xl font-semibold text-[var(--text)]">{{ metric.value }}</span>
              <span class="text-sm text-[var(--text-dim)]" *ngIf="metric.unit">{{ metric.unit }}</span>
            </div>
          </div>
        </div>
      </app-glass-card>
    </div>
  </app-glass-card>
</ng-container>

<ng-template #emptyState>
  <div *ngIf="showEmptyState" class="glass glass-strong p-6 text-[var(--text-dim)] text-center">
    {{ 'PATIENT.DASHBOARD.EMPTY' | translate }}
  </div>
</ng-template>
