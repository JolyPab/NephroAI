<div class="space-y-6">
  <div class="space-y-2">
    <h2 class="text-2xl sm:text-3xl font-semibold text-[var(--text)]">{{ 'dashboard.title' | translate }}</h2>
    <p class="text-sm sm:text-base text-[var(--text-dim)] max-w-2xl">
      {{ 'dashboard.subtitle' | translate }}
    </p>
  </div>

  <div *ngIf="loading" class="glass glass-strong flex flex-col items-center justify-center gap-3 min-h-[220px] text-center">
    <div class="animate-spin h-10 w-10 border-2 border-[var(--accent)] border-t-transparent rounded-full"></div>
    <p class="text-sm text-[var(--text-dim)]">{{ 'dashboard.loading' | translate }}</p>
  </div>

    <div *ngIf="!loading && errorMessage" class="glass glass-strong p-4 text-[var(--danger)] border border-[var(--danger)]/40">
    {{ errorMessage }}
    </div>

  <div *ngIf="!loading && !errorMessage && analyses.length === 0" class="glass glass-strong p-6 text-[var(--text-dim)] text-center">
    {{ 'dashboard.empty' | translate }}
  </div>

  <ng-container *ngIf="!loading && analyses.length > 0">
    <app-glass-card [extraClass]="'glass-strong flex flex-col gap-4'">
      <div class="flex flex-wrap justify-between gap-3 items-start">
        <div>
          <h3 class="text-xl font-semibold text-[var(--text)]">{{ 'dashboard.latest' | translate }}</h3>
          <p class="text-sm text-[var(--text-dim)]">
            {{ 'dashboard.date' | translate }}
            <span *ngIf="latestDate(analyses[0]); else noDate">
              {{ latestDate(analyses[0]) | date: 'd MMMM yyyy' }}
            </span>
            <ng-template #noDate>â€”</ng-template>
          </p>
        </div>
        <button type="button" appGlassButton routerLink="/patient/charts">
          <i class="bi bi-graph-up"></i>
          <span class="hidden sm:inline">{{ 'dashboard.goCharts' | translate }}</span>
          <span class="sm:hidden">{{ 'dashboard.charts' | translate }}</span>
        </button>
      </div>

      <div class="grid gap-4 sm:grid-cols-2 xl:grid-cols-3">
        <app-glass-card
          *ngFor="let metric of analyses[0].metrics"
          [extraClass]="'glass-strong h-full'">
          <div class="flex items-start justify-between gap-3">
            <div class="space-y-1">
              <p class="uppercase text-[var(--text-dim)] text-xs tracking-[0.2em]">{{ metric.name }}</p>
              <div class="flex items-baseline gap-2">
                <span class="text-3xl font-semibold text-[var(--text)]">{{ metric.value }}</span>
                <span class="text-sm text-[var(--text-dim)]" *ngIf="metric.unit">{{ metric.unit }}</span>
              </div>
            </div>
          </div>
          <p class="text-xs text-[var(--text-dim)] mt-4" *ngIf="metric.ref_min || metric.ref_max">
            {{ 'dashboard.range' | translate }} {{ metric.ref_min ?? '-' }} - {{ metric.ref_max ?? '-' }}
          </p>
        </app-glass-card>
      </div>
    </app-glass-card>
  </ng-container>
</div>
